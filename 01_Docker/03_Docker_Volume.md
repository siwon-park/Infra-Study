![Docker image](https://user-images.githubusercontent.com/93081720/174341063-d8894c50-7452-49b0-ae2f-7a4b019dc8a9.png)

# 03_Docker_Volume

## 01_데이터

데이터의 분류 => 어플리케이션, 임시 앱 데이터, 영구 앱 데이터

![image](https://user-images.githubusercontent.com/93081720/180634741-52a53d58-f5e3-4d89-9cec-92dd4379ee7c.png)

### 어플리케이션

- 이미지에 쓰는 코드들은 이미지가 일단 빌드되고 나면 컨테이너 실행 중에 수정을 해도 반영되지 않고 이미지를 다시 빌드해야 적용이 되므로 읽기 전용 데이터임



### 임시 앱 데이터

- 컨테이너 실행 도중에 생성되고 불러오는 데이터로, 메모리나 임시 파일에 잠시 저장되는 데이터
- 컨테이너를 삭제하면 동시에 삭제되는 데이터(컨테이너가 중지된다고 해서 무조건 임시 데이터가 삭제되는 것은 아님)

- 예) 유저 인풋



### 영구 앱 데이터

- 테이너 실행 도중에 생성되고 불러오는 데이터로, 파일이나 데이터베이스에 저장되는 데이터
- 컨테이너가 중지, 재시작되더라도 데이터가 삭제되어서는 안 됨

- 예) 유저 계정 정보

```
docker build -t feedback-node .

docker run -p 3000:80 -d --name feedback-app --rm feedback-node:latest
```

<br>

## 02_Volume(볼륨)

> 컨테이너와 맵핑된 호스트 머신(내 컴퓨터)의 폴더, 하드 드라이브 저장 공간

컨테이너를 중지하더라도 볼륨은 여전히 유지되며, 컨테이너를 (재)시작하면 해당 볼륨의 데이터를 컨테이너에서 사용 가능함

컨테이너는 볼륨에 있는 데이터를 읽고/쓸 수 있음

![image](https://user-images.githubusercontent.com/93081720/180636189-a5091868-6dd1-43de-86ec-aeb14c3cfd99.png)

### 기본 명령어

- `docker volume --help` : volume에 대한 명렁어를 알아볼 수 있음
- `docker volume ls` : 볼륨 리스트를 출력함



### 익명 볼륨(Anonymous Volume)

> 이름을 따로 명명하지 않은 볼륨

Dockerfiled에 작성하여 볼륨 생성 가능

`VOLUME ["경로"]`

![image](https://user-images.githubusercontent.com/93081720/183292460-aa00b626-9795-4fa9-b333-c02bdd418895.png)

- 경로
  - 여기서 말하는 "/app/feedback"과 같은 "경로"는 실제 우리 컴퓨터(호스트 머신)의 디렉토리 위치가 아니라, 내 컨테이너 내부의 위치임
  - 도커가 관리하며, 개발자는 실제 해당 위치가 호스트 머신 상 어디에 있는지 정확하게 모름

**익명 볼륨은 컨테이너가 종료되면 없어진다** 



#### 익명 볼륨 제거하기

컨테이너가 제거되면, 익명 볼륨은 자동으로 제거됨. 이는 '`--rm`' 옵션으로 컨테이너를 시작/실행할 때 발생하게 됨

그러나 `--rm` 옵션 없이 컨테이너를 시작하면, 컨테이너를 (`docker rm ... `으로) 제거하더라도 **익명 볼륨은 제거되지 않음**

그래도 컨테이너를 다시 만들어, 다시 실행하면(즉, docker run ... 다시 실행), **새 익명 볼륨이 생성됨** 

즉, 익명 볼륨이 자동으로 제거되지 않았지만, 다음에 컨테이너가 시작될 때, 다른 익명 볼륨이 연결되기 때문에, 이전 컨테이너를 제거하고 새 컨테이너를 실행하는데 도움이 되지 않음

이제 **사용하지 않는 익명 볼륨이 쌓이기** 시작하는데,  '`docker volume rm <볼륨명>`' 또는 '`docker volume prune`'을 통해 **볼륨을 삭제** 가능



### 기명 볼륨(Named Volume)

> 이름을 따로 정의해준 볼륨

익명 볼륨과 마찬가지로 도커에 의해 관리되며 컨테이너가 종료되어도 우리의 하드디스크 상에 남아있어 컨테이너를 다시 켜도 볼륨을 사용 가능함

- 기명 볼륨 생성하기
  - 컨테이너를 만들 때(run할 때) 지정해줌
  - `-v <볼륨명>:<주소>`
  - 예) `docker run -d -p 3000:80 --rm --name feedback-app -v feedback:/app/feedback feedback-node:volumes`



### 바인드 마운트(Bind Mount)

> 개발자에 의해 관리되며, 호스트 머신 상 맵핑된 폴더/주소를 지정 가능함 => 필요에 따라 우리가 직접 수정 가능

Docker file로 빌드하는 소스코드를 스냅샷으로 복사하지 않고 바인드 마운트에 복사하는 개념

컨테이너를 생성하면서 `-v <절대경로:맵핑할 주소>` 형태로 사용

- 예) `-v "/User/siwon-park:/app"` => 맵핑할 경로까지 포함하여 ""(따옴표)로 감싸주는 것이 좋다. 왜냐하면 폴더/주소명에 특수문자나 공백이 있을 경우에 따옴표 없이 사용할 경우 인식을 제대로 못해 에러가 발생하기 때문임
- 바로 가기(직접 절대 경로를 복사하지 않고 다음과 같이 바로 가기 형태로 사용 가능)
  - `-v "%cd%":/app` (Window)
  - `-v $(pwd):/app` (MacOs/Linux)



