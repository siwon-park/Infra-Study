![kubernets](https://user-images.githubusercontent.com/93081720/174333422-4e2f7a03-f585-4edf-884c-0af7fea7ac5d.png)



# 07_쿠버네티스 클러스터 구축하기

실제 서버를 여러 대 사용해서 클러스터를 구축하는 방법

- 물리적 머신이나 가상 머신을 필요한 만큼 준비(마스터 노드 포함)
- 마스터 노드 역할을 할 머신에 k8s, etcd, CNI를 설치함(`kubeadm` 사용)
- 마스터 노드에서 `kubeadm init`으로 클러스터 초기화
- 워커 노드에서 `kubeadm join`으로 마스터와 연결

## 1. 용어 정리

### Kubeadm

쿠버네티스에서 제공하는 기본적인 도구로 쿠버네티스 클러스터 구축을 위한 다양한 기능을 제공한다.

<img src="https://user-images.githubusercontent.com/93081720/221210314-9f2c21c4-9a2f-421b-8bf2-217fcf5a1bc7.png" referrerpolicy="no-referrer" alt="image" height="200px">

※ 부트스트랩핑(bootstrapping) : 부팅의 현재 진행형(부팅이라고 이해하는 게 더 빠름)

- `kubeadm init` : 쿠버네티스 컨트롤 플레인 노드를 부트스트랩한다.
- `kubeadm join` : 쿠버네티스 워커 노드를 부트스트랩하고 클러스터에 연결시킨다.

<br>

### CNI (Container Network Interface)

컨테이너 네트워크 인터페이스

> 컨테이너 간의 네트워킹을 제어할 수 있는 플러그인을 만들기 위한 표준

다양한 형태의 컨테이너 런타임과 오케스트레이터 사이의 네트워크 계층을 구현하는 방식이 다양하게 분리되어 각자만의 방식으로 발전되는 것을 막고자 등장한 공통된 네트워크 인터페이스를 말한다.

컨테이너는 자신만의 격리된 공간을 가지고 있으며, 특정 컨테이너는 컨테이너 안에서 내부적으로 독립된 네트워크 환경을 가지고 있을 수도 있다. 그런데 이 때 문제가 생기는 부분이, 외부의 다른 네트워크 환경을 전혀 알 수 없다는 것이다. 여러 컨테이너를 관리하거나 2개 이상의 모듈로 동작하는 시스템을 각 각 컨테이너화한 경우, 컨테이너 간의 네트워킹도 필요하다.

이를 위해 컨테이너에게 가상의 네트워크 리소스를 부여하고 관리해주는 것이 CNI다.

쿠버네티스 뿐만 아니라, Amazon ESC 등 컨테이너 런타임 환경을 포함하고 있는 다양한 플랫폼들은 CNI를 사용하고 있다.

쿠버네티스는 기본적으로 `kubenet`이라는 자체적인 CNI 플러그인을 제공하지만 네트워크 기능이 제한적이라는 단점이 있어 해당 단점을 보완하기 위해 3rd-party 플러그인을 사용하는데, 그 종류에는 `Flannel`, `Calico`, `Weavenet` `NSX`등 다양한 종류가 있다.

CNI가 수행하는 역할은 크게

- 컨테이너들의 네트워크 연결
- 컨테이너 삭제 시 할당된 자원의 제거

결국 쿠버네티스에서 CNI를 사용하는 이유는 `파드(Pod) 간의 통신을 위해서 사용`한다.

<br>

## 2. 사전 준비 및 쿠버네티스 설치

### 마스터-워커 노드 IP 주소 확인

미리 사전에 마스터 노드와 워커 노드로 쓰일 서버의 public IP 주소를 정리해두면 구축 시 용이하다.

<br>

## 3. 클러스터 구성